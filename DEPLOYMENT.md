# Развертывание платежной системы на Railway

## Подготовка к развертыванию

### 1. Создание аккаунта Railway

1. Перейдите на [railway.app](https://railway.app)
2. Зарегистрируйтесь через GitHub
3. Подтвердите email

### 2. Подготовка репозитория

Убедитесь, что в папке `payment_system` есть все необходимые файлы:
- `package.json`
- `server.js`
- `index.html`
- `script.js`
- `style.css`
- `env.example`

## Развертывание

### 1. Создание проекта

1. В панели Railway нажмите "New Project"
2. Выберите "Deploy from GitHub repo"
3. Выберите ваш репозиторий
4. Укажите папку `payment_system` как root directory

### 2. Настройка переменных окружения

В разделе Variables добавьте:

```env
BOT_API_URL=https://paymentsysatem-production.up.railway.app/
YOOKASSA_SHOP_ID=1086529
YOOKASSA_SECRET_KEY=test_fItob0t2XOZPQETIa7npqoKf5PsxbXlrMTHV88P4WZA
TEST_MODE=true
WEBHOOK_SECRET=ваш_webhook_секрет
PORT=3001
```

### 3. Настройка домена

1. В разделе Settings найдите "Domains"
2. Нажмите "Generate Domain" или добавьте кастомный домен
3. Запишите полученный URL (например: `paymentsystem-production.up.railway.app`)

### 4. Обновление URL в боте

Обновите URL в файле `optimization_bot.py`:

```python
payment_url = f"https://paymentsysatem-production.up.railway.app/?start_param=user_id_{user_id}"
```

## Настройка ЮKassa

### 1. Получение реальных данных

1. Зарегистрируйтесь в [ЮKassa](https://yookassa.ru)
2. Пройдите верификацию
3. Получите Shop ID и Secret Key

### 2. Настройка webhook'ов

В панели ЮKassa:
1. Перейдите в "Настройки" → "Уведомления"
2. Добавьте URL: `https://ваш-домен.up.railway.app/webhook`
3. Выберите события: "Успешный платеж", "Отмена платежа"
4. Сохраните webhook secret

## Проверка развертывания

### 1. Проверка доступности

Откройте в браузере: `https://ваш-домен.up.railway.app`

Должна отобразиться страница с тарифными планами.

### 2. Проверка API

Проверьте endpoint здоровья:
```bash
curl https://ваш-домен.up.railway.app/health
```

Ответ должен быть: `{"status": "OK"}`

### 3. Проверка логов

В панели Railway перейдите в раздел "Logs" для мониторинга работы приложения.

## Мониторинг

### 1. Логи Railway

- Автоматические логи развертывания
- Логи работы приложения
- Ошибки и предупреждения

### 2. Метрики

Railway предоставляет:
- Использование CPU
- Использование памяти
- Сетевой трафик

### 3. Уведомления

Настройте уведомления в Railway для:
- Ошибок развертывания
- Превышения лимитов ресурсов
- Недоступности сервиса

## Обновление

### Автоматическое обновление

Railway автоматически пересобирает приложение при push в основную ветку репозитория.

### Ручное обновление

1. В панели Railway нажмите "Redeploy"
2. Выберите нужный коммит
3. Дождитесь завершения развертывания

## Безопасность

### 1. Переменные окружения

- Никогда не коммитьте реальные ключи в репозиторий
- Используйте только переменные окружения Railway
- Регулярно обновляйте секретные ключи

### 2. HTTPS

Railway автоматически предоставляет SSL сертификаты для всех доменов.

### 3. Ограничения доступа

Рассмотрите добавление:
- Rate limiting
- IP whitelist для webhook'ов
- Дополнительную аутентификацию

## Масштабирование

### 1. Вертикальное масштабирование

Railway автоматически масштабирует ресурсы в зависимости от нагрузки.

### 2. Горизонтальное масштабирование

При необходимости можно развернуть несколько инстансов с балансировщиком нагрузки.

## Резервное копирование

### 1. Код

Код автоматически сохраняется в GitHub репозитории.

### 2. Конфигурация

Регулярно экспортируйте переменные окружения и настройки Railway.

### 3. Логи

Настройте внешнее логирование для долгосрочного хранения логов.

## Устранение неполадок

### Частые проблемы

1. **Приложение не запускается**
   - Проверьте переменные окружения
   - Проверьте логи развертывания

2. **Webhook'и не работают**
   - Проверьте URL webhook'а в ЮKassa
   - Проверьте webhook secret

3. **Платежи не проходят**
   - Проверьте Shop ID и Secret Key
   - Проверьте режим работы (TEST_MODE)

### Контакты поддержки

- Railway: [help.railway.app](https://help.railway.app)
- ЮKassa: [yookassa.ru/support](https://yookassa.ru/support)

## Стоимость

Railway предоставляет:
- $5 бесплатно каждый месяц
- Оплата по факту использования
- Прозрачное ценообразование

Для небольших проектов обычно достаточно бесплатного лимита. 